
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.0">
    
    
      
        <title>OpenBMP with Juniper cRPD - Hemant Sharma</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="red">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#openbmp-with-juniper-crpd" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Hemant Sharma" class="md-header__button md-logo" aria-label="Hemant Sharma" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m1-7v3h2l-3 3-3-3h2v-3m-6 0h3v2l3-3-3-3v2H5m6 0V8H9l3-3 3 3h-2v3m6 0h-3V9l-3 3 3 3v-2h3"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hemant Sharma
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OpenBMP with Juniper cRPD
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hmntsharma/openbmp-crpd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hmntsharma/openbmp-crpd
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="." class="md-tabs__link md-tabs__link--active">
      OpenBMP with Juniper cRPD
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Hemant Sharma" class="md-nav__button md-logo" aria-label="Hemant Sharma" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8m1-7v3h2l-3 3-3-3h2v-3m-6 0h3v2l3-3-3-3v2H5m6 0V8H9l3-3 3 3h-2v3m6 0h-3V9l-3 3 3 3v-2h3"/></svg>

    </a>
    Hemant Sharma
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hmntsharma/openbmp-crpd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hmntsharma/openbmp-crpd
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          OpenBMP with Juniper cRPD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        OpenBMP with Juniper cRPD
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisite" class="md-nav__link">
    Pre-Requisite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#my-infrastructure" class="md-nav__link">
    My Infrastructure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#topology" class="md-nav__link">
    Topology
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clone-the-repository" class="md-nav__link">
    Clone the repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-topology" class="md-nav__link">
    Deploy the topology
  </a>
  
    <nav class="md-nav" aria-label="Deploy the topology">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-openbmp" class="md-nav__link">
    Deploy OpenBMP
  </a>
  
    <nav class="md-nav" aria-label="Deploy OpenBMP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verify-the-containers-are-up-and-running" class="md-nav__link">
    Verify the containers are up and running
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-the-custom-network-bridge-was-also-deployed" class="md-nav__link">
    Verify the custom network bridge was also deployed
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-containerlab" class="md-nav__link">
    Deploy Containerlab
  </a>
  
    <nav class="md-nav" aria-label="Deploy Containerlab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verify-host3-prefix-in-vrf-crpd-of-pe1" class="md-nav__link">
    Verify HOST3 prefix in vrf CRPD of PE1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-bmp-session-with-openbmp-collector" class="md-nav__link">
    Verify BMP Session with OpenBMP Collector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grafana-dashboard" class="md-nav__link">
    Grafana Dashboard
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bmp-testing" class="md-nav__link">
    BMP Testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-the-lab" class="md-nav__link">
    Save the lab
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shutdown-the-containerlab-and-openbmp-deployment" class="md-nav__link">
    Shutdown the containerlab and OpenBMP deployment
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="openbmp-with-juniper-crpd">OpenBMP with Juniper cRPD</h1>
<p>BGP Monitoring Protocol (BMP) test using containerized Juniper cRPD, OpenBMP and Containerlab</p>
<h2 id="pre-requisite">Pre-Requisite</h2>
<ul>
<li>Install <a href="https://www.docker.com/">Docker</a> and <a href="https://docs.docker.com/compose/install/">Docker Compose</a></li>
<li>Download, Load and Install <a href="https://www.juniper.net/gb/en/dm/crpd-free-trial.html">Juniper cRPD</a></li>
<li>Install test license, else BGP won't work, although this lab already comes with a test license </li>
<li>I have also used <a href="https://www.juniper.net/documentation/us/en/software/crpd/crpd-deployment/topics/task/cRPD-Linux-Server-Docker-Routing-Mode.html">Juniper cRPD Deployment Guide for Linux Server</a> as reference</li>
<li>Install <a href="https://hub.docker.com/r/wbitt/network-multitool">wbitt/network-multitool</a> docker image</li>
<li>Install <a href="https://containerlab.dev/">containerlab</a></li>
<li>Install <a href="https://www.openbmp.org/getting_started.html">OpenBMP</a> docker containers</li>
<li><a href="https://www.openbmp.org/getting_started.html#steps-to-bring-up-openbmp-on-a-single-vm">OpenBMP deployement guide</a></li>
<li>I have customized the docker-compose.yml settings as I needed to add an Internet proxy for grafana container</li>
<li>Also defined a network bridge configuration with a static IPv4 subnet and addresses assigned to each container</li>
<li>Kindly customize as per your infrastructure</li>
</ul>
<h2 id="my-infrastructure">My Infrastructure</h2>
<ul>
<li>An ubuntu 18.04 LTS virtual machine with 8vCPU and 16GB RAM, running in an eve-ng server, uses an http proxy for Internet</li>
<li>I have used the <a href="https://github.com/hmntsharma/clab-crpdmpls">hmntsharma/clab-crpdmpls</a> lab as base and added the BMP configuration for further testing</li>
<li>I request you to take a look at it before you proceed further</li>
</ul>
<h2 id="topology">Topology</h2>
<p><img alt="image" src="https://user-images.githubusercontent.com/101124549/164953682-77ca40f2-4faf-4eb3-aded-5df310f1b7e5.png" /></p>
<h2 id="clone-the-repository">Clone the repository</h2>
<pre><code>lab@ubuntu1804:~/github$ sudo git clone https://github.com/hmntsharma/openbmp-crpd.git
Cloning into 'openbmp-crpd'...
remote: Enumerating objects: 59, done.
remote: Counting objects: 100% (59/59), done.
remote: Compressing objects: 100% (43/43), done.
remote: Total 59 (delta 12), reused 56 (delta 12), pack-reused 0
Unpacking objects: 100% (59/59), done.
lab@ubuntu1804:~/github$
</code></pre>
<h2 id="deploy-the-topology">Deploy the topology</h2>
<p>The lab is deployed in 2 steps, first deploy OpenBMP and then the containerlab</p>
<h3 id="deploy-openbmp">Deploy OpenBMP</h3>
<p>Change to the cloned lab directory</p>
<pre><code>lab@ubuntu1804:~/github$ cd openbmp-crpd/
lab@ubuntu1804:~/github/openbmp-crpd$ ll
total 28
drwxr-xr-x 5 root root 4096 Apr 24 04:09 clab-openbmp-crpd
-rw-r--r-- 1 root root 8348 Apr 24 04:09 docker-compose.yml
drwxr-xr-x 2 root root 4096 Apr 24 04:09 linux_net_config
-rw-r--r-- 1 root root 1087 Apr 24 04:09 openbmp-crpd.yml
-rw-r--r-- 1 root root  109 Apr 24 04:09 README.md
lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<p>OpenBMP is deployed as per the steps <a href="https://www.openbmp.org/getting_started.html#steps-to-bring-up-openbmp-on-a-single-vm">here</a>, of which the 6th step is as below</p>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo OBMP_DATA_ROOT=/var/openbmp docker-compose -f docker-compose.yml -p obmp up -d
Creating obmp-collector ...
Creating obmp-psql ...
Creating obmp-zookeeper ...
Creating obmp-whois ...
Creating obmp-psql-app ...
Creating obmp-collector
Creating obmp-psql
Creating obmp-grafana ...
Creating obmp-whois
Creating obmp-psql-app
Creating obmp-zookeeper
Creating obmp-zookeeper ... done
Creating obmp-kafka ...
Creating obmp-kafka ... done
lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<h4 id="verify-the-containers-are-up-and-running">Verify the containers are up and running</h4>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo docker ps
CONTAINER ID   IMAGE                             COMMAND                  CREATED          STATUS          PORTS                                       NAMES
9666f03d3b1e   confluentinc/cp-kafka:7.0.1       &quot;/etc/confluent/dock…&quot;   21 seconds ago   Up 19 seconds   0.0.0.0:9092-&gt;9092/tcp, :::9092-&gt;9092/tcp   obmp-kafka
06148a4cfb86   grafana/grafana:8.3.4             &quot;/run.sh&quot;                27 seconds ago   Up 21 seconds   0.0.0.0:3000-&gt;3000/tcp, :::3000-&gt;3000/tcp   obmp-grafana
4b8d69af4c7a   confluentinc/cp-zookeeper:7.0.1   &quot;/etc/confluent/dock…&quot;   27 seconds ago   Up 20 seconds   2181/tcp, 2888/tcp, 3888/tcp                obmp-zookeeper
6b6d43abc8bb   openbmp/whois:2.1.0               &quot;/bin/sh -c '/usr/lo…&quot;   27 seconds ago   Up 22 seconds   0.0.0.0:4300-&gt;43/tcp, :::4300-&gt;43/tcp       obmp-whois
401fe9e65ecc   openbmp/psql-app:2.1.1            &quot;/usr/sbin/run&quot;          27 seconds ago   Up 10 seconds   0.0.0.0:9005-&gt;9005/tcp, :::9005-&gt;9005/tcp   obmp-psql-app
d2449e61081b   openbmp/postgres:2.1.1            &quot;docker-entrypoint.s…&quot;   27 seconds ago   Up 25 seconds   0.0.0.0:5432-&gt;5432/tcp, :::5432-&gt;5432/tcp   obmp-psql
207b5b9a7b94   openbmp/collector:2.1.1           &quot;/usr/sbin/run&quot;          27 seconds ago   Up 26 seconds   0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   obmp-collector
lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<h4 id="verify-the-custom-network-bridge-was-also-deployed">Verify the custom network bridge was also deployed</h4>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo docker network ls | grep obmp_openbmp
38f423aba261   obmp_openbmp   bridge    local
lab@ubuntu1804:~/github/openbmp-crpd$



lab@ubuntu1804:~/github/openbmp-crpd$ sudo brctl show br-openbmp
bridge name     bridge id               STP enabled     interfaces
br-openbmp              8000.0242ce2d03fa       no              veth09e97d3
                                                        veth15e0060
                                                        veth27f08b1
                                                        veth4138d88
                                                        veth41c1999
                                                        veth533c3b6
                                                        vethf16387a
lab@ubuntu1804:~/github/openbmp-crpd$



lab@ubuntu1804:~/github/openbmp-crpd$ sudo docker network inspect obmp_openbmp | grep -i -E &quot;name|ipv4&quot;
        &quot;Name&quot;: &quot;obmp_openbmp&quot;,
                &quot;Name&quot;: &quot;obmp-grafana&quot;,
                &quot;IPv4Address&quot;: &quot;172.18.18.4/24&quot;,
                &quot;Name&quot;: &quot;obmp-collector&quot;,
                &quot;IPv4Address&quot;: &quot;172.18.18.6/24&quot;,
                &quot;Name&quot;: &quot;obmp-psql-app&quot;,
                &quot;IPv4Address&quot;: &quot;172.18.18.7/24&quot;,
                &quot;Name&quot;: &quot;obmp-zookeeper&quot;,
                &quot;IPv4Address&quot;: &quot;172.18.18.2/24&quot;,
                &quot;Name&quot;: &quot;obmp-whois&quot;,
                &quot;IPv4Address&quot;: &quot;172.18.18.8/24&quot;,
                &quot;Name&quot;: &quot;obmp-kafka&quot;,
                &quot;IPv4Address&quot;: &quot;172.18.18.3/24&quot;,
                &quot;Name&quot;: &quot;obmp-psql&quot;,
                &quot;IPv4Address&quot;: &quot;172.18.18.5/24&quot;,
            &quot;com.docker.network.bridge.name&quot;: &quot;br-openbmp&quot;
lab@ubuntu1804:~/github/openbmp-crpd$



lab@ubuntu1804:~/github/openbmp-crpd$ ip addr show br-openbmp
1879: br-openbmp: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default
    link/ether 02:42:ce:2d:03:fa brd ff:ff:ff:ff:ff:ff
    inet 172.18.18.1/24 brd 172.18.18.255 scope global br-openbmp
       valid_lft forever preferred_lft forever
    inet6 fe80::42:ceff:fe2d:3fa/64 scope link
       valid_lft forever preferred_lft forever
lab@ubuntu1804:~/github/openbmp-crpd$



lab@ubuntu1804:~/github/openbmp-crpd$ ip link show | grep br-openbmp
1879: br-openbmp: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT group default
1918: veth41c1999@if1917: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-openbmp state UP mode DEFAULT group default
1920: veth533c3b6@if1919: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-openbmp state UP mode DEFAULT group default
1922: veth15e0060@if1921: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-openbmp state UP mode DEFAULT group default
1926: vethf16387a@if1925: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-openbmp state UP mode DEFAULT group default
1928: veth4138d88@if1927: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-openbmp state UP mode DEFAULT group default
1930: veth09e97d3@if1929: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-openbmp state UP mode DEFAULT group default
1934: veth27f08b1@if1933: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-openbmp state UP mode DEFAULT group default
lab@ubuntu1804:~/github/openbmp-crpd$

</code></pre>
<h3 id="deploy-containerlab">Deploy Containerlab</h3>
<p>The above deployment creates the bridge, which is then referenced in the containerlab topology definition yml file</p>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo clab deploy -t openbmp-crpd.yml
INFO[0000] Containerlab v0.25.1 started
INFO[0000] Parsing &amp; checking topology file: openbmp-crpd.yml
INFO[0000] Creating lab directory: /home/lab/github/openbmp-crpd/clab-openbmp-crpd
INFO[0000] Creating docker network: Name=&quot;clab&quot;, IPv4Subnet=&quot;172.20.20.0/24&quot;, IPv6Subnet=&quot;2001:172:20:20::/64&quot;, MTU=&quot;1500&quot;
INFO[0000] config file '/home/lab/github/openbmp-crpd/clab-openbmp-crpd/PE3/config/juniper.conf' for node 'PE3' already exists and will not be generated/reset
INFO[0000] Creating container: &quot;HOST3&quot;
INFO[0000] Creating container: &quot;PE3&quot;
INFO[0000] config file '/home/lab/github/openbmp-crpd/clab-openbmp-crpd/PE1/config/juniper.conf' for node 'PE1' already exists and will not be generated/reset
INFO[0000] config file '/home/lab/github/openbmp-crpd/clab-openbmp-crpd/CR2/config/juniper.conf' for node 'CR2' already exists and will not be generated/reset
INFO[0000] Creating container: &quot;HOST1&quot;
INFO[0000] Creating container: &quot;PE1&quot;
INFO[0000] Creating container: &quot;CR2&quot;
INFO[0001] Creating virtual wire: PE1:eth8 &lt;--&gt; br-openbmp:eth8
INFO[0003] Creating virtual wire: PE1:eth1 &lt;--&gt; CR2:eth1
INFO[0004] Creating virtual wire: PE3:eth3 &lt;--&gt; HOST3:eth3
INFO[0004] Creating virtual wire: CR2:eth2 &lt;--&gt; PE3:eth2
INFO[0005] Creating virtual wire: PE1:eth3 &lt;--&gt; HOST1:eth3
INFO[0005] Adding containerlab host entries to /etc/hosts file
+---+-------+--------------+-------------------------+-------+---------+----------------+----------------------+
| # | Name  | Container ID |          Image          | Kind  |  State  |  IPv4 Address  |     IPv6 Address     |
+---+-------+--------------+-------------------------+-------+---------+----------------+----------------------+
| 1 | CR2   | 4fd403e68be9 | crpd:21.4R1.12          | crpd  | running | 172.20.20.3/24 | 2001:172:20:20::3/64 |
| 2 | HOST1 | a3aed457dcca | wbitt/network-multitool | linux | running | 172.20.20.5/24 | 2001:172:20:20::5/64 |
| 3 | HOST3 | 909e22b6bd73 | wbitt/network-multitool | linux | running | 172.20.20.4/24 | 2001:172:20:20::4/64 |
| 4 | PE1   | 04f194959d9c | crpd:21.4R1.12          | crpd  | running | 172.20.20.2/24 | 2001:172:20:20::2/64 |
| 5 | PE3   | 2f2d57a38264 | crpd:21.4R1.12          | crpd  | running | 172.20.20.6/24 | 2001:172:20:20::6/64 |
+---+-------+--------------+-------------------------+-------+---------+----------------+----------------------+
lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<h4 id="verify-host3-prefix-in-vrf-crpd-of-pe1">Verify HOST3 prefix in vrf CRPD of PE1</h4>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo docker exec PE1 cli show route table CRPD.inet.0 protocol bgp

CRPD.inet.0: 3 destinations, 3 routes (3 active, 0 holddown, 0 hidden)
+ = Active Route, - = Last Active, * = Both

192.168.200.0/24   *[BGP/170] 00:00:39, localpref 100, from 3.3.3.3
                      AS path: I, validation-state: unverified
                    &gt;  to 10.1.2.2 via eth1, Push 16, Push 17(top)
lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<h4 id="verify-bmp-session-with-openbmp-collector">Verify BMP Session with OpenBMP Collector</h4>
<p>The PE1 router is a BMP client of obmp-collector docker container, which is listening on port 5000</p>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo docker exec PE1 cli show bgp bmp
Station name: BMP_AIO
  Local address/port: 172.18.18.100/-, Station address/port: 172.18.18.6/5000, active
  State: established Local: 172.18.18.100+38443 Remote: 172.18.18.6+5000
  Last state change: 1:43
  Monitor BGP Peers: enabled
  Route-monitoring: pre-policy
  Hold-down: 600, flaps 3, period 300
  Initiation message: Development/LAB
  Priority: low
  Statistics timeout: 300
  Version: 3
  Routing Instance: default
  Trace options:  all
  Trace file: /var/log//bmp.log size 10485760 files 10
lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<h2 id="grafana-dashboard">Grafana Dashboard</h2>
<p>Grafana dashboard is running on https port 3000. which can be seen in the output of <code>sudo docker ps</code> above
I have used ssh tunneling to access the https dashboard at 127.0.0.1:3000</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101124549/164953919-2e54defa-86e5-40d3-828f-b5db5925711d.png" /></p>
<p>Our test focuses on the following dashboards</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101124549/164953941-ece5115d-421e-4a96-a51c-733ac01c3c3a.png" /></p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101124549/164953983-60f5a68a-2332-4c37-ace2-35d64fd7e48f.png" /></p>
<h2 id="bmp-testing">BMP Testing</h2>
<p>Activate and deactivate eth3 interface on PE3, to trigger BGP advertisement and withdrawal, which would also reflect in Grafana dashboard</p>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo docker exec -it PE3 cli
root@PE3&gt; edit
Entering configuration mode

[edit]
root@PE3# deactivate routing-instances CRPD interface eth3

[edit]
root@PE3# commit
commit complete

[edit]
root@PE3# activate routing-instances CRPD interface eth3

[edit]
root@PE3# commit
commit complete

[edit]
root@PE3# exit
Exiting configuration mode

root@PE3&gt; exit

lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<p>Withdrawal and Advertisement auto updated in the dashboard below</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101124549/164954064-1f829fb6-a728-4929-8464-db28f0237cac.png" /></p>
<p>I have also setup traceoptions in PE1 to monitor bmp logs, which can be checked as below</p>
<pre><code>root@PE1&gt; monitor start bmp.log

root@PE1&gt;
*** bmp.log ***
Apr 24 02:45:24.806033 task_timer_reset: reset BMPW_a.172.18.18.6+5000_Read
Apr 24 02:45:24.806069 task_timer_set_oneshot_latest: timer BMPW_a.172.18.18.6+5000_Read interval set to 14.234762
Apr 24 02:45:25.613076 station BMP_AIO peer 3.3.3.3 (Internal AS 65001) pw 0x5637631c1780 set_flag 0x10
Apr 24 02:45:25.613128 creating write_job for station BMP_AIO, priority 7
Apr 24 02:45:25.613134 task_job_create_background: create prio 7 job write_job for task BMPa
Apr 24 02:45:25.613881 background dispatch running job write_job for task BMPa
Apr 24 02:45:25.613903 running write_job for station BMP_AIO
Apr 24 02:45:25.613907 start work &amp;s-&gt;bmps_work_head=0x5637648f1450 work_head=0x5637631c17a0
Apr 24 02:45:25.613911 bmp_do_peer_work: do work for peer 3.3.3.3 (Internal AS 65001), station BMP_AIO bmppw_flags 0x258
Apr 24 02:45:25.613915 did work for pw 0x5637631c1780: write_res: 0   flags: 58 d 0
Apr 24 02:45:25.613918 requeue peer for more work, pw 0x5637631c1780, station BMP_AIO
Apr 24 02:45:25.613921 bmp_do_peer_work: do work for peer 3.3.3.3 (Internal AS 65001), station BMP_AIO bmppw_flags 0x58
Apr 24 02:45:25.613925 bmp_send_rm_tuple called for pre-policy, peer 3.3.3.3 (Internal AS 65001), station BMP_AIO
Apr 24 02:45:25.613933 bmp_send_rm_tuple called, found pre-policy prefix 65001:100:192.168.200.0/88, peer 3.3.3.3 (Internal AS 65001), station BMP_AIO
Apr 24 02:45:25.613955 generating pre-policy add for prefix 65001:100:192.168.200.0/88, peer 3.3.3.3 (Internal AS 65001), station BMP_AIO
Apr 24 02:45:25.613970 BMPW: creating write_job for station BMP_AIO, priority 7
Apr 24 02:45:25.613979 task_job_create_background: create prio 7 job station_writer_job for task BMPW_a.172.18.18.6+5000
Apr 24 02:45:25.613983 bmp_send_rm_tuple called, no next pre-policy prefix, peer 3.3.3.3 (Internal AS 65001), station BMP_AIO 0xd 0x258
Apr 24 02:45:25.613986 did work for pw 0x5637631c1780: write_res: 0   flags: 248 d 0
Apr 24 02:45:25.614011 send per station adj-rib-out feed, station BMP_AIO
Apr 24 02:45:25.614015 bgp_bmp_do_station_ribout_rm_work: All adj ribout work done for station BMP_AIO
Apr 24 02:45:25.614018 check if station done: work empty=1 loc rib work empty=1 adj rib work empty=1 write_res: 0
Apr 24 02:45:25.614021 write_job work complete, station BMP_AIO
Apr 24 02:45:25.614024 task_job_delete: delete background job write_job for task BMPa
Apr 24 02:45:25.614033 background dispatch completed job write_job for task BMPa
Apr 24 02:45:25.614187 background dispatch running job station_writer_job for task BMPW_a.172.18.18.6+5000
Apr 24 02:45:25.614202 BMPW: running write job for station BMP_AIO
Apr 24 02:45:25.614228 BMPW: type 0 (RM), len 132, ver 3, pre-policy, for Peer 3.3.3.3, station BMP_AIO
Apr 24 02:45:25.614238  Peer AS: 65001 Peer BGP Id: 3.3.3.3 Time: 1650768325:60656 (Apr 24 02:45:25)
Apr 24 02:45:25.614242   Update: message type 2 (Update) length 84
Apr 24 02:45:25.614246   Update: Update PDU length 84
Apr 24 02:45:25.614255   Update: flags 0x40 code Origin(1): IGP
Apr 24 02:45:25.614265   Update: flags 0x40 code ASPath(2) length 0: &lt;null&gt;
Apr 24 02:45:25.614268   Update: flags 0x40 code LocalPref(5): 100
Apr 24 02:45:25.614274   Update: flags 0xc0 code Extended Communities(16): 2:65001:100
Apr 24 02:45:25.614279   Update: flags 0x90 code MP_reach(14): AFI/SAFI 1/128
Apr 24 02:45:25.614286   Update:        nhop 3.3.3.3 len 12
Apr 24 02:45:25.614303   Update:        65001:100:192.168.200.0/24 (label 16)
Apr 24 02:45:25.614309 BMPW: check if station done bmp_msg_start=(nil), pre policy rib-in = 1, post policy rib-in = 1, loc rib = 1, pre policy rib-out = 1, post policy rib-out = 1|1, ressult: Write in buffer
Apr 24 02:45:25.614312 BMPW: requesting write for 132 bytes, to station BMP_AIO
Apr 24 02:45:25.614434 BMPW: all 132 bytes written, station BMP_AIO
Apr 24 02:45:25.614446 BMPW: write_job work complete, station BMP_AIO
Apr 24 02:45:25.614449 task_job_delete: delete background job station_writer_job for task BMPW_a.172.18.18.6+5000
Apr 24 02:45:25.614454 background dispatch completed job station_writer_job for task BMPW_a.172.18.18.6+5000
Apr 24 02:45:39.041315 task_timer_reset: reset BMPW_a.172.18.18.6+5000_Read
Apr 24 02:45:39.041426 task_timer_set_oneshot_latest: timer BMPW_a.172.18.18.6+5000_Read interval set to 14.023228


root@PE1&gt;
</code></pre>
<h2 id="save-the-lab">Save the lab</h2>
<p>After each config commit, it is best practice to save the lab, else all the configuration would be lost</p>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo clab save -t openbmp-crpd.yml
INFO[0000] Parsing &amp; checking topology file: openbmp-crpd.yml
INFO[0000] saved cRPD configuration from CR2 node to /home/lab/github/openbmp-crpd/clab-openbmp-crpd/CR2/config/juniper.conf
INFO[0000] saved cRPD configuration from PE1 node to /home/lab/github/openbmp-crpd/clab-openbmp-crpd/PE1/config/juniper.conf
INFO[0000] saved cRPD configuration from PE3 node to /home/lab/github/openbmp-crpd/clab-openbmp-crpd/PE3/config/juniper.conf
lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<h2 id="shutdown-the-containerlab-and-openbmp-deployment">Shutdown the containerlab and OpenBMP deployment</h2>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo clab destroy -t openbmp-crpd.yml
INFO[0000] Parsing &amp; checking topology file: openbmp-crpd.yml
INFO[0000] Destroying lab: openbmp-crpd
INFO[0000] Removed container: CR2
INFO[0000] Removed container: HOST3
INFO[0000] Removed container: PE3
INFO[0000] Removed container: HOST1
INFO[0000] Removed container: PE1
INFO[0000] Removing containerlab host entries from /etc/hosts file
lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<pre><code>lab@ubuntu1804:~/github/openbmp-crpd$ sudo OBMP_DATA_ROOT=/var/openbmp docker-compose -p obmp down
Stopping obmp-kafka     ... done
Stopping obmp-grafana   ... done
Stopping obmp-zookeeper ... done
Stopping obmp-whois     ... done
Stopping obmp-psql-app  ... done
Stopping obmp-psql      ... done
Stopping obmp-collector ... done
Removing obmp-kafka     ... done
Removing obmp-grafana   ... done
Removing obmp-zookeeper ... done
Removing obmp-whois     ... done
Removing obmp-psql-app  ... done
Removing obmp-psql      ... done
Removing obmp-collector ... done
Removing network obmp_openbmp
lab@ubuntu1804:~/github/openbmp-crpd$
</code></pre>
<h1 id="thank-you">Thank You!</h1>




              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.instant", "navigation.tracking", "navigation.expand", "navigation.top", "toc.integrate"], "search": "assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>